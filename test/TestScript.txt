| test compiler

if 2^(1+3) /= 16  then throw(-1)

compile("|**|")     | make sure |**| works at the end of the file

bool1 := true and false, if bool1 then throw(-1)

if { not true }[1]  then throw(-1)



| test array creation / reading / writing

a :: [5] int
b :: [3] a
if size(b) /= 15*size(int)  then throw(-1)

if size(a[<1, 0>]) /= 0  then throw(-1)
if size(a[<6, 5>]) /= 0  then throw(-1)

c :: [2] a[<2, 4>]
c = { { 1, 2, 3 }, { 4, 5, 6 } }
if floor(c[2][1]) /= 4  then throw(-1)

d :: [3] int
d[*] = @a[<2, 4>]

g := @a[<2,4>]
d[1] = 4
g = { 4, 0, 0 }
if g /= { 4, 0, 0 }  then throw(-1)

q *:: [] int
q2 := @q
if q /= @nothing or q2 /= @nothing  then throw(-1)
q3 :: q, q3[^1], q = @q2 = @q3
if q /= q2 or q /= q3 or q /= { 0 }  then throw(-1)

t *:: {int, 3.5}, v :: t
if t /= @nothing or v /= { 0, 3.5 }  then throw(-1)

dbg :: [*] int
dbg :: [*] int

if {} /= [0] int  then throw(-1)

fEl := 0
if trap(f :: [] { fEl }) == 0  then throw(-1)

comp :: {}
if trap(comp[+0]) == 0 or top(comp) /= 0  then throw(-1)

asize := 2, arr :: [] { [asize] int }

a1 :: [2][2] int, a2 :: [2] { int, int }, a3 :: [3] int
a1 = a2 = { { 1, 2 }, { 3, 4 } }
if a1 /= a2  then throw(-1)
if trap(a1[2][] = a3[]) /= 29  then throw(-1)

s :: { type :: int }, if type(int) /= 2  then throw(-1)



| aliasing tests

v1 :: int, (al1 := @v1) = 1



| find() tests

if find("a  b c", "  "; mode = 0) /= 1  or  find("a  b c", "  ") /= 2  or find("a  b c", "  "; mode = -1; startPosition = 5) /= 2  then throw(100)



| misc tests

remove f, f :: { ; return abs(args[1]+1) }, f(1), trap(f(true)), if f(-2) /= 1  then throw(-1)

c1 *:: c2 *:: {int}
if (o1 :: c1 : c2 : {double}) /= {0, 0}  then throw(-1)     | c1 and c2 create the same (anonymous) member

f2 :: { a:=1; a = that + 1; print(a) }
f2b :: f2 : { ; a = that + 1; print(a) }
f2b(), if f2b /= { 3 }  then throw(-1)          | make sure code #2 runs when code #1 ends with a code marker

print("Finished tests!\n")
