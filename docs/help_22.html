<HTML>

<HEAD>
<TITLE>Cicada Help: Putting the C in Cicada</TITLE>

<a href="https://heltilda.github.io/cicada/index.html">Cicada</a> ---> <a href="https://heltilda.github.io/cicada/toc.html">Online Help Docs</a> ---> <a href="https://heltilda.github.io/cicada/help_2.html">Example:  memory networks in Cicada</a>

<H1> <CENTER> Putting the C in Cicada </CENTER> </H1>
</HEAD>

<BODY>



<P> Our C code focuses on the training loops (where speed is crucial) but memory allocation/deallocation, dataset loading, saving of results, etc. are all more easily scripted.  In fact let&rsquo;s just have C immediately hand off control to the Cicada interpreter, and tell Cicada to callback <tt>runNetwork()</tt> as needed.  To do this, include the Cicada header in <tt>NN.c</tt> and <tt>NN.h</tt>:

<P> 

<P><P><tt> 

<br>&nbsp;&nbsp;&nbsp; #include &lt;cicada.h&gt;

<br>&nbsp;&nbsp;&nbsp; </tt>

<P>

<P>  and add following to <tt>NN.c</tt> (say, just before <tt>runNetwork</tt>):

<P> 

<P><P><tt> 

<br>&nbsp;&nbsp;&nbsp; const Cfunction fs[] = { { &quot;runNetwork&quot;, &amp;runNetwork } };

<br>&nbsp;&nbsp;&nbsp; 

<br>&nbsp;&nbsp;&nbsp; int main(int argc, char **argv)

<br>&nbsp;&nbsp;&nbsp; {

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;return runCicada(fs, NULL, true);

<br>&nbsp;&nbsp;&nbsp; }

<br>&nbsp;&nbsp;&nbsp; </tt>

<P>

<P>  We also need to adjust the definition of <tt>runNetwork()</tt> so that Cicada can call it properly.  The new function prototype (in both <tt>NN.c</tt> and <tt>NN.h</tt>) is:

<P> 

<P><P><tt> 

<br>&nbsp;&nbsp;&nbsp; ccInt runNetwork(argsType args)

<br>&nbsp;&nbsp;&nbsp; </tt>

<P>

<P>  An <tt>argsType</tt> variable holds a list of Cicada variables passed into a C function call.  The <tt>ccInt</tt> return type is user-definable but defaults to just <tt>int</tt>.

<P> Finally, we need to set up our variables at the beginning of <tt>runNetwork()</tt>, using Cicada&rsquo;s functions for a) checking and b) loading data/pointers from <tt>args</tt>.  Since memory is shared between the two environments, any pointers we load can be used to send data back to Cicada.  Replace the &lsquo;set up data types&rsquo; block comment with the following code:

<P> 

<P><P><tt> 

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;myNN.numNeurons = args.indices[1];

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;numInputs = args.indices[2];

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;if (args.num &lt; 4)&nbsp;return 1;

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;if (getArgs(args,

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arrayRef(double_type, &amp;myNN.weights),

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arrayRef(double_type, &amp;myNN.activity),

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arrayRef(double_type, &amp;inputs),

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scalarValue(double_type, &amp;step_size),

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;endArgs) != 0)&nbsp;return 2;

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;if (args.num == 6)&nbsp;{

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;numOutputs = args.indices[4];

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (getArgs(args, fromArg(4),

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arrayRef(double_type, &amp;target_outputs),

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scalarValue(double_type, &amp;learning_rate)

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;) != 0)&nbsp;return 3;

<br>&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;}

<br>&nbsp;&nbsp;&nbsp; </tt>

<P>

<P>  Our code loads pointers for <tt>myNN.weights</tt>, <tt>myNN.activity</tt> and <tt>inputs</tt>.  There are two reasons to load these parameters by reference: 1) they are arrays not scalars, and 2) our C code will modify the values of <tt>activity</tt> and <tt>weights</tt> and we want those changes to persist outside of the function call.  However, <tt>step_size</tt> and <tt>learning_rate</tt> are constant scalar parameters, so we load their data by value using the <tt>scalarValue()</tt> macro.

<P> The C code doesn&rsquo;t need to save any results, since its data is shared with Cicada, and there are scripting functions for writing to files (e.g. <tt>save()</tt> or  <tt>saveTable()</tt>).  Just delete the &ldquo;save results&rdquo; comment line in <tt>NN.c</tt>.<P>

<P> It&rsquo;s time to build our program.  To link against the Cicada library use the linker flag <tt>-lcicada</tt>.  (For example, using <tt>gcc</tt> on a UNIX machine the command would be: <tt>gcc -lcicada -o NN NN.c</tt>).  With luck, we&rsquo;ll end up with an executable which we can run from the command prompt (by typing &lsquo;<tt>NN</tt>&rsquo; or &lsquo;<tt>./NN</tt>&rsquo;, depending on the system).  We should see:

<P> 

<P><P><tt> 

<br>&nbsp;&nbsp;&nbsp; &gt; 

<br>&nbsp;&nbsp;&nbsp; </tt>

<P>

<P> <ul>
</ul><br><P><div align="center"><a href="https://heltilda.github.io/cicada/help_21.html">Prev: C implementation</a> &nbsp;&nbsp;
<a href="https://heltilda.github.io/cicada/help_23.html">Next: Writing and debugging a Cicada wrapper</a>
</div><br><br><P>Last update: November 12, 2025